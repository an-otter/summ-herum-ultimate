<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="de">
<head>
    <title>Mein Tagebuch</title>
</head>
<body style="font-family: sans-serif;">

<div th:replace="~{menu :: navbar}"></div>

<div style="max-width: 800px; margin: 0 auto;">

    <h1>ğŸ“– Reisetagebuch</h1>

    <div style="background-color: #e8f5e9; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
        <h3>Neuen Eintrag schreiben âœï¸</h3>
        <form th:action="@{/saveEntry}" method="post">

            <label>Titel:</label><br>
            <input type="text" name="title" required placeholder="Ein toller Tag..." style="width: 100%; padding: 5px;"><br><br>

            <label>Text:</label><br>
            <textarea name="text" required placeholder="Liebes Tagebuch..." style="width: 100%; height: 100px; padding: 5px;"></textarea><br><br>

            <label>Datum:</label><br>
            <input type="date" name="date" required><br><br>

            <label>Reise:</label><br>
            <select name="journeyId" required style="padding: 5px; width: 300px;">
                <option th:each="journey : ${journeyListe}"
                        th:value="${journey.id}"
                        th:text="${journey.title}">
                </option>
            </select>
            <br><br>

            <label>Ort:</label><br>
            <select name="locationId" required style="padding: 5px; width: 300px;">
                <option th:each="ort : ${orteListe}"
                        th:value="${ort.id}"
                        th:text="${ort.name}">
                </option>
            </select>
            <br><br>

            <button type="submit" style="background-color: #4CAF50; color: white; border: none; padding: 10px 20px; cursor: pointer;">
                Eintrag speichern âœ…
            </button>
        </form>
    </div>

    <hr>

    <h3>Deine Erlebnisse:</h3>

    <div th:each="entry : ${entryListe}"
         style="border: 1px solid #ddd; margin: 15px 0; padding: 15px; border-left: 5px solid #4CAF50; background-color: #fff;">

        <h3 th:text="${entry.title}" style="margin-top: 0;">Titel</h3>

        <small th:text="${#dates.format(entry.timestamp, 'dd.MM.yyyy')}" style="color: gray;">Datum</small>

        <div class="raw-markdown" style="display: none;" th:text="${entry.text}"></div>

        <div class="rendered-html" style="margin-top: 10px; font-family: sans-serif;"></div>

        <hr style="border: 0; border-top: 1px dashed #ccc;">

        <div style="font-size: 0.9em; color: #555;">
                <span th:if="${entry.journey != null}">
                    âœˆï¸ Reise: <strong th:text="${entry.journey.title}">Reise</strong>
                </span>

            <span th:if="${entry.journey.user != null}" style="color: #2196F3;">
                        (von <span th:text="${entry.journey.user.username}">Name</span>)
                    </span>

            <span style="margin: 0 10px;">|</span>

            <span th:if="${entry.location != null}">
                    ğŸŒ Ort: <strong th:text="${entry.location.name}">Ort</strong>
                </span>

            <span style="margin: 0 10px;">|</span>
            <span th:if="${entry.weather != null}">
                    ğŸŒ¡ï¸ Wetter: <strong th:text="${entry.weather}">20Â°C</strong>
                </span>
            </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
    // holt uns alle EintrÃ¤ge
    const rawTexts = document.querySelectorAll('.raw-markdown');
    const targetDivs = document.querySelectorAll('.rendered-html');

    // geht durch jeden Eintrag durch
    for (let i = 0; i < rawTexts.length; i++) {
        // Hole den Text (z.B. "**Hallo**")
        const text = rawTexts[i].innerText;

        // Wandelt ihn in HTML um (z.B. "<b>Hallo</b>")
        // Die Funktion marked.parse() kommt aus der Bibliothek
        const htmlContent = marked.parse(text);

        // Steckt das HTML in das Anzeige-Div
        targetDivs[i].innerHTML = htmlContent;
    }
</script>

</body>
</html>


