<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="de">
<head>
    <title>Meine Timeline</title>
</head>
<body style="font-family: sans-serif; background-color: #f4f4f4;">

<div th:replace="~{menu :: navbar}"></div>

<div style="max-width: 800px; margin: 0 auto;">

    <h1 style="text-align: center;">â³ Deine Reise-Timeline (Neueste zuerst)</h1>

    <div style="position: relative; margin-top: 40px;">

        <div style="position: absolute; left: 20px; top: 0; bottom: 0; width: 4px; background-color: #FF9800;"></div>

        <div th:each="entry : ${timelineList}" style="margin-bottom: 30px; position: relative; padding-left: 50px;">

            <div style="position: absolute; left: 12px; top: 0; width: 20px; height: 20px; background-color: #FF9800; border-radius: 50%; border: 3px solid white;"></div>

            <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">

                <div style="display: flex; justify-content: space-between; color: gray; font-size: 0.9em; margin-bottom: 10px;">
                    <span th:text="${#dates.format(entry.timestamp, 'dd.MM.yyyy')}">Datum</span>

                    <span th:if="${entry.location != null}">
                            ğŸ“ <span th:text="${entry.location.name}">Ort</span>
                    </span>
                </div>

                <h2 th:text="${entry.title}" style="margin-top: 0; color: #333;">Titel</h2>

                <div class="raw-markdown" style="display: none;" th:text="${entry.text}"></div>
                <div class="rendered-html" style="color: #555;"></div>

                <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee; font-size: 0.9em;">

                        <span th:if="${entry.journey != null && entry.journey.user != null}" style="color: #2196F3;">
                           (von <span th:text="${entry.journey.user.username}">User</span>)
                        </span>

                    <span th:if="${entry.weather != null}" style="margin: 0 10px; color: #ccc;">|</span>

                    <span th:if="${entry.weather != null}">
                            ğŸŒ¡ï¸ Wetter: <strong th:text="${entry.weather}">...</strong>
                        </span>
                </div>

            </div>
        </div>

        <div th:if="${timelineList.isEmpty()}" style="padding-left: 50px;">
            <p>Noch keine EintrÃ¤ge vorhanden ğŸœï¸ <a href="/entries">Schreib den ersten! ğŸ¤—</a></p>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    const rawTexts = document.querySelectorAll('.raw-markdown');
    const targetDivs = document.querySelectorAll('.rendered-html');
    for (let i = 0; i < rawTexts.length; i++) {
        targetDivs[i].innerHTML = marked.parse(rawTexts[i].innerText);
    }
</script>

</body>
</html>